<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Premiers pas avec R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Module4 - Manipulation_files/libs/clipboard/clipboard.min.js"></script>
<script src="Module4 - Manipulation_files/libs/quarto-html/quarto.js"></script>
<script src="Module4 - Manipulation_files/libs/quarto-html/popper.min.js"></script>
<script src="Module4 - Manipulation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Module4 - Manipulation_files/libs/quarto-html/anchor.min.js"></script>
<link href="Module4 - Manipulation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Module4 - Manipulation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Module4 - Manipulation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Module4 - Manipulation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Module4 - Manipulation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Premiers pas avec R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<hr>
<section id="manipuler-des-tableaux-avec-r" class="level1">
<h1>Manipuler des tableaux avec R</h1>
<hr>
<section id="bienvenue-dans-ce-quatrième-module-de-la-formation-introduction-au-logiciel-r." class="level3">
<h3 class="anchored" data-anchor-id="bienvenue-dans-ce-quatrième-module-de-la-formation-introduction-au-logiciel-r.">Bienvenue dans ce quatrième module de la formation “Introduction au logiciel R”.</h3>
<p>La librairie Tidyverse, déjà utilisée dans le module 3 pour manipuler les colonnes et les lignes d’un tableau, propose également des fonctions puissantes pour transformer directement un tableau de donnée en un autre tableau, évitant parfois de nombreuses étapes fastidieuses.</p>
<p>Ici nous verrons notamment :</p>
<ol type="1">
<li><p><strong>Comment résumer un jeu de données à un tableau de synthèse avec group_by et summarise,</strong></p></li>
<li><p><strong>Comment rechaper un tableau avec la fonction pivot</strong></p></li>
</ol>
<p>Vous apprendrez également à utiliser le <strong>symbôle d’assignation &lt;-</strong> et à creer un jeu de données d’exemple.</p>
<hr>
<hr>
<p>La librairie Tidyverse, déjà utilisée dans le module 3 pour manipuler les colonnes et les lignes d’un tableau, propose également des fonctions puissantes pour transformer directement un tableau de donnée en un autre tableau, évitant parfois de nombreuses étapes fastidieuses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ purrr::%||%()   masks base::%||%()
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
<section id="résumer-un-tableau-avec-group_by-et-summarise" class="level2">
<h2 class="anchored" data-anchor-id="résumer-un-tableau-avec-group_by-et-summarise">1 Résumer un tableau avec group_by et summarise</h2>
<p>Une constante en statistique est la présence de groupes ou de catégories qui <strong>séparent l’échantillon.</strong> On parle de <strong>ventilation</strong>. Les variables qui permettent de ventiler les éléments d’un échantillon s’appelle, dans le langage R, <strong>un facteur</strong>.</p>
<p>Par exemple, le jeu de données diamonds utilisé dans le module 3 contient trois variables facteur :</p>
<ul>
<li><p>cut : la qualité de la découpe du diamant, de Fair à Ideal (5 niveaux)</p></li>
<li><p>color : la couleur, de A à G (7 niveaux)</p></li>
<li><p>clarity : la clarté, de I1 à IF (8 niveaux)</p></li>
</ul>
<p>Pour obtenir la liste des modalités de chaque facteurs, on utilise la fonction level()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diamonds<span class="sc">$</span>cut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fair"      "Good"      "Very Good" "Premium"   "Ideal"    </code></pre>
</div>
</div>
<p>La fonction <strong>group_by()</strong> en association avec la fonction <strong>summarise()</strong> vous permet de réaliser à la volée des opérations sur chaque portion de tableau correspondant à un groupe.</p>
<p>Par exemple, on peut calculer la <strong>valeur moyenne du prix des diamants en fonction de leur clarté</strong> en deux étapes :</p>
<ol type="1">
<li><p><strong>On déclare le facteur utilisé</strong> pour faire les regroupement (ici clarity) dans la fonction <strong>group_by</strong></p></li>
<li><p>On <strong>déclare la variable et la fonction de synthèse</strong> dans la fonction summarise : ici la variable price et la fonction de synthèse mean(price)</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul du prix moyen des diamants en fonction de leur clarté</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(clarity) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(price))    <span class="co"># on déclare ici la fonction de résumé souhaitée</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 2
  clarity Moyenne
  &lt;ord&gt;     &lt;dbl&gt;
1 I1        3924.
2 SI2       5063.
3 SI1       3996.
4 VS2       3925.
5 VS1       3839.
6 VVS2      3284.
7 VVS1      2523.
8 IF        2865.</code></pre>
</div>
</div>
<p>On peut ajouter <strong>autant de colonnes de résumé que souhaité</strong> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul du prix moyen, median et de l'écart-typedu prix des diamants en fonction de leur clarté</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(clarity) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(price),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">Mediane =</span> <span class="fu">median</span>(price),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Ecart-type"</span> <span class="ot">=</span> <span class="fu">sd</span>(price))    <span class="co"># Ici, les guillements sont nécessaires à cause du "-"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 4
  clarity Moyenne Mediane `Ecart-type`
  &lt;ord&gt;     &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;
1 I1        3924.    3344        2807.
2 SI2       5063.    4072        4260.
3 SI1       3996.    2822        3799.
4 VS2       3925.    2054        4042.
5 VS1       3839.    2005        4012.
6 VVS2      3284.    1311        3822.
7 VVS1      2523.    1093        3335.
8 IF        2865.    1080        3920.</code></pre>
</div>
</div>
<p>On peut également combiner <strong>plusieurs facteurs</strong> de ventilation :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul du prix moyen, median et de l'écart-typedu prix des diamants en fonction de leur clarté et de leur découpe</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(clarity, cut) <span class="sc">%&gt;%</span>   <span class="co"># pour une combinaison des facteurs</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(price),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">Mediane =</span> <span class="fu">median</span>(price),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Ecart-type"</span> <span class="ot">=</span> <span class="fu">sd</span>(price)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 5
# Groups:   clarity [8]
   clarity cut       Moyenne Mediane `Ecart-type`
   &lt;ord&gt;   &lt;ord&gt;       &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;
 1 I1      Fair        3704.   2397         3099.
 2 I1      Good        3597.   3118.        2285.
 3 I1      Very Good   4078.   3283         2720.
 4 I1      Premium     3947.   3261         2827.
 5 I1      Ideal       4336.   3674.        2671.
 6 SI2     Fair        5174.   3681         3928.
 7 SI2     Good        4580.   3770         3901.
 8 SI2     Very Good   4989.   4042         4126.
 9 SI2     Premium     5546.   4291         4488.
10 SI2     Ideal       4756.   4060.        4252.
# ℹ 30 more rows</code></pre>
</div>
</div>
<p>Mais on peut aller <strong>plus loin.</strong> En effet, l<strong>a fonction mutate() est sensible à la fonction group_by(). On peut donc réaliser sur un même tableau des opérations sur l’ensemble des données ou par groupes.</strong></p>
<p>Supposons que je souhaite centrer et réduire le prix de mes diamants pour chaque groupe de découpe. Je peux procéder de la manière suivante :</p>
<ol type="1">
<li><p>Calculer la moyenne et l’écart-type de chaque groupe et la reporter dans le tableau avec la fonction mutate()</p></li>
<li><p>Calculer la valeur centrée réduite par groupe de chaque diamants</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul du prix moyen, median et de l'écart-type du prix des diamants en fonction de leur clarté et de leur découpe</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>diamonds <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cut) <span class="sc">%&gt;%</span>   </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Moyenne =</span> <span class="fu">mean</span>(price),               <span class="co"># On utilise la fonction mutate plutôt que summarise</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Ecart-type"</span> <span class="ot">=</span> <span class="fu">sd</span>(price)) <span class="sc">%&gt;%</span>  </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prix_centre =</span> price <span class="sc">-</span> Moyenne,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">prix_centre_reduit =</span> prix_centre <span class="sc">/</span> <span class="st">`</span><span class="at">Ecart-type</span><span class="st">`</span>) <span class="sc">%&gt;%</span>  <span class="co"># on rétuilise le résultat précédent</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cut,price,Moyenne,<span class="st">`</span><span class="at">Ecart-type</span><span class="st">`</span>, prix_centre,prix_centre_reduit) <span class="sc">%&gt;%</span> </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cut)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 53,940 × 6
   cut   price Moyenne `Ecart-type` prix_centre prix_centre_reduit
   &lt;ord&gt; &lt;int&gt;   &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;              &lt;dbl&gt;
 1 Fair    337   4359.        3560.      -4022.             -1.13 
 2 Fair   2757   4359.        3560.      -1602.             -0.450
 3 Fair   2759   4359.        3560.      -1600.             -0.449
 4 Fair   2762   4359.        3560.      -1597.             -0.448
 5 Fair   2762   4359.        3560.      -1597.             -0.448
 6 Fair   2763   4359.        3560.      -1596.             -0.448
 7 Fair   2763   4359.        3560.      -1596.             -0.448
 8 Fair   2777   4359.        3560.      -1582.             -0.444
 9 Fair   2782   4359.        3560.      -1577.             -0.443
10 Fair   2788   4359.        3560.      -1571.             -0.441
# ℹ 53,930 more rows</code></pre>
</div>
</div>
<p><strong>Pourquoi de tels écarts ? Comment y remédier ?</strong></p>
<hr>
<hr>
<section id="exercice-dapplication" class="level3">
<h3 class="anchored" data-anchor-id="exercice-dapplication"><em>Exercice d’application :</em></h3>
<p>A partir du dataset diamonds :</p>
<ol type="1">
<li><p>Grâce à la fonction <strong>mutate()</strong>, calculez le prix de chaque diamant rapporté à son poids (carat)</p></li>
<li><p>Grâce à la fonction <strong>summarise()</strong>, construisez un tableau de synthèse fournissant le prix par carat moyen et son écart-type en fonction de leur découpe (facteur cut)</p></li>
<li><p>Grâce à la fonction <strong>mutate()</strong>, Calculez enfin le prix par carat centré-réduit de chaque diamant par groupe de découpe</p></li>
<li><p>Concluez</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecrivez votre code ici :</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="comment-rechaper-un-tableau-avec-la-fonction-pivot" class="level2">
<h2 class="anchored" data-anchor-id="comment-rechaper-un-tableau-avec-la-fonction-pivot"><strong>2-Comment rechaper un tableau avec la fonction pivot</strong></h2>
<p>Le fichier de données classique contient un enregistrement par ligne et une variable par colonne. Ce format de tableau n’est pas toujours idéal pour l’analyse. Dans les tableaurs, on utilise souvent une fonction appelée tableau croisé dynamique qui permet de construire des tableaux de synthèse (pivot table en anglais). Cette fonctionnalité est assurée dans R par deux fonctions :</p>
<ul>
<li><p>pivot_wider : cette fonction permet de créer autant de colonnes qu’il y a de modalités d’un facteur. Mécaniquement, le nombre de colonnes augmente, le tableau devient plus large, d’où le nom de la fonction pivot_<strong>wider</strong></p></li>
<li><p>pivot_longer : à l’inverse, on peut décider de concentrer plusieurs colonnes de sorte qu’une colonne précise le nom de la variable et la colonne associée sa modalité. Le nombre de colonnes diminue mais le nombre de lignes augmente. Le tableau s’allonge, d’où le nom de la fonction pivot<strong>_longer</strong></p></li>
</ul>
<p>Un exemple valant mieux qu’un long discours, voici un tableau au <strong>format</strong> <strong>“long”</strong></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clipboard-200595491.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Et voici le même tableau au <strong>format “wide”</strong> avec un <strong>pivot sur la variable year</strong>. La colonne unique “year” a été transformé en plusieurs colonnes portant le nom de l’année en question. La valeur des ventes (sales) a été utilisée telle que pour remplir le tableau.</figcaption>
</figure>
</div>
<p><img src="images/clipboard-3415304310.png" class="img-fluid"></p>
<p>Voici comment procéder pour cela avec R. Créons d’abord l’exemple. Pour le conserver en mémoire pour la suite, nous allons l’assigner à une variable que nous appelerons “long”. On utilise pour cela <strong>le symbôle d’assignation &lt;-.</strong> La fonction <strong>tibble()</strong> permet de créer un tableau dans R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creation et assignation d'un tableau de mémoire</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>long <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Product =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2020</span>, <span class="dv">2021</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sales =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">250</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  Product  Year Sales
  &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
1 A        2020   100
2 A        2021   150
3 B        2020   200
4 B        2021   250</code></pre>
</div>
</div>
<p>Cette fois, le tableau ne s’affiche pas directement dans le document car il est mis en mémoire mais vous pouvez le retrouver dans l’explorateur d’environnement en haut à droite de R Studio.</p>
<p><img src="images/clipboard-479202456.png" class="img-fluid"></p>
<p><strong>Passage d’un tableau “long” à un tableau “wide”</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Passage d'un format de tableau long à un format de tableau wide</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>wide <span class="ot">&lt;-</span> long <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> <span class="st">"Year"</span>,         <span class="co"># On définit la variable d'où proviennent les futures étiquettes de colonne</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="st">"Sales"</span>        <span class="co"># On définit la variable où l'on va trouver les valeurs pour remplir le tableau</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  Product `2020` `2021`
  &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
1 A          100    150
2 B          200    250</code></pre>
</div>
</div>
<p><strong>Passage d’un tableau “wide” à un tableau “long”</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Passage d'un format de tableau wide à un format de tableau long</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>wide <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> <span class="sc">-</span>Product,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> <span class="st">"Year"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> <span class="st">"Sales"</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  Product Year  Sales
  &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;
1 A       2020    100
2 A       2021    150
3 B       2020    200
4 B       2021    250</code></pre>
</div>
</div>
<hr>
<hr>
<section id="exercice-dapplication-1" class="level3">
<h3 class="anchored" data-anchor-id="exercice-dapplication-1"><em>Exercice d’application :</em></h3>
<p>Le code ci-dessous créé le tableau de données “notes_long”, executez le puis suivez les instruction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Création du tableau d'exemple :</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>notes_long <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Etudiant =</span> <span class="fu">c</span>(<span class="st">"Jean"</span>, <span class="st">"Jean"</span>, <span class="st">"Jean"</span>, <span class="st">"Jean"</span>, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Jeanne"</span>, <span class="st">"Jeanne"</span>, <span class="st">"Jeanne"</span>, <span class="st">"Jeanne"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Alice"</span>, <span class="st">"Alice"</span>, <span class="st">"Alice"</span>, <span class="st">"Alice"</span>),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  Matière <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Maths"</span>, <span class="st">"Histoire"</span>, <span class="st">"Maths"</span>, <span class="st">"Histoire"</span>, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Maths"</span>, <span class="st">"Histoire"</span>, <span class="st">"Maths"</span>, <span class="st">"Histoire"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"Maths"</span>, <span class="st">"Histoire"</span>, <span class="st">"Maths"</span>, <span class="st">"Histoire"</span>),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Semestre =</span> <span class="fu">c</span>(<span class="st">"Automne"</span>, <span class="st">"Automne"</span>, <span class="st">"Printemps"</span>, <span class="st">"Printemps"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Automne"</span>, <span class="st">"Automne"</span>, <span class="st">"Printemps"</span>, <span class="st">"Printemps"</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Automne"</span>, <span class="st">"Automne"</span>, <span class="st">"Printemps"</span>, <span class="st">"Printemps"</span>),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Note =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">90</span>, <span class="dv">88</span>, <span class="dv">92</span>, <span class="dv">95</span>, <span class="dv">80</span>, <span class="dv">93</span>, <span class="dv">85</span>, <span class="dv">78</span>, <span class="dv">82</span>, <span class="dv">80</span>, <span class="dv">85</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>notes_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   Etudiant Matière  Semestre   Note
   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
 1 Jean     Maths    Automne      85
 2 Jean     Histoire Automne      90
 3 Jean     Maths    Printemps    88
 4 Jean     Histoire Printemps    92
 5 Jeanne   Maths    Automne      95
 6 Jeanne   Histoire Automne      80
 7 Jeanne   Maths    Printemps    93
 8 Jeanne   Histoire Printemps    85
 9 Alice    Maths    Automne      78
10 Alice    Histoire Automne      82
11 Alice    Maths    Printemps    80
12 Alice    Histoire Printemps    85</code></pre>
</div>
</div>
<p><strong>1-</strong>A l’aide de la fonction <strong>pivot_wider</strong>, transformez le tableau note_long en un tableau note_wide correspondant au tableau ci-dessous.</p>
<p><img src="images/clipboard-3440111423.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecrivez votre code ici:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>2-A l’aide de la fonction <strong>group_by</strong> et <strong>summarise</strong>, affichez un tableau résumé des moyennes annuelles de chaque étudiant dans les deux matières identique à celui-ci.</p>
<p><img src="images/clipboard-2952717993.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecrivez votre code ici:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A l’aide de l’aide de la fonction pivot_wider, trouvez une manière de réaliser le tableau des moyennes sans utilise group_by ni summarise</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ecrivez votre code ici :</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Copyright</h2><div id="quarto-copyright" class="quarto-appendix-contents"><div>Barthélémy DURETTE 2024 tous droits réservés</div></div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>